<html>

<head>
<script type="text/javascript" src="lib/jquery-1.11.0.min.js"></script>
<script type="text/javascript" src="lib/jquery-ui-1.10.4.custom.min.js"></script>
<script type="text/javascript" src="js/card.js"></script>
<script type="text/javascript" src="js/tichu.js"></script>
<script type="text/javascript" src="js/player.js"></script>
<script type="text/javascript" src="js/table.js"></script>
<script type="text/javascript" src="js/graphics.js"></script>
<script type="text/javascript" src="js/network.js"></script>
<script type="text/javascript" src="js/chat.js"></script>
<script type="text/javascript" src="js/actions.js"></script>
<script type="text/javascript" src="js/score.js"></script>
<script type="text/javascript" src="js/gameConnect.js"></script>
<script type="text/javascript" src="js/CombinaisonsValidator.js"></script>

<link rel="stylesheet" type="text/css" href="css/ui-lightness/jquery-ui-1.10.4.custom.min.css"/>
<link rel="stylesheet" type="text/css" href="css/style.css"/>

</head>

<body>

<canvas id="canvas" width="600" height="400" style="border:solid 1px black;float:left"></canvas>
<div id="idScoreDiv" style="float:left;width:200px;color:white;background-color:#111111;height:400px;text-align:center">
    <div style="float:left;width:49%">Eux</div>
    <div style="float:left;width:49%">Nous</div>
    <hr style="clear:both;border:dashed 1px white;margin-bottom:20px"/>
    <div class="scoreLeft" style="float:left;width:49%"></div>
    <div class="scoreRight" style="float:left;width:49%"></div>
    <hr style="clear:both"/>
    <div class="totalScoreLeft" style="float:left;width:49%"></div>
    <div class="totalScoreRight" style="float:left;width:49%"></div>
</div>
<div style="clear:both"></div>
<div id="actions"></div>
<div style="width:600px;height:150px;overflow:auto" id="idChatDiv"></div>
<input type="text" style="width:500px;" id="idMessage"/>

<div id="selectGame">
    <div id="idMessageInfo"></div>
    Game : <input type="text" id="idGameName" value="test"/><button id="idLoadGame">OK</button><br/>
    <span class="glue"></span>
    <span style="" class="box joueur_N">N : <span></span></span>     <br/>
    <span style="" class="box joueur_O">O : <span></span></span>
    <span class="glue">
         <input type="text" style="width:100%" id="idRename"/>
         <span id="idPass" style="display:none;"><input type="password" style="width:100%"/></span>
    </span>
    <span style="" class="box joueur_E">E : <span></span></span><br/>
    <span class="glue"></span>
    <span style="" class="box joueur_S">S : <span></span></span>     <br/>
    <hr/>
    <div class="error" id="idErrorMessage"></div>
</div>

<div id="idMahjongChoice">
    <canvas height="160" width="240"></canvas>
</div>

<script>

GameConnect.init();
PlayerManager.init();
CardManager.init();
Actions.init();
Chat.init();
Scorer.init();
ComponentManager.run();

    $('#idMahjongChoice').dialog({
       autoOpen:false,
        title:'Mahjong choice',
        width:280,
        height:300,
    buttons:[
     {text:'No value',click:function(){}},
     {text:'Define',click:function(){defineMahjong();}}
    ]
    });
    function drawCards(selectedValue){
        var cardCanvas = $('#idMahjongChoice > canvas').get(0).getContext('2d');
        cardCanvas.clearRect(0,0,250,200);
        for(var i = 2 ; i <= 14 ; i++){
            var value = i < 11 ? i : i == 11 ? 'V' : i == 12 ? 'D' : i == 13 ? 'K':'A';
            var selected = selectedValue!=null && selectedValue == i ? 3:1;
            drawCard(cardCanvas,(i-2)%5*50,Math.floor((i-2)/5)*55,0,false,25,40,{val:value,color:"green"},null,"S",selected);
        }
    }

    $('#idMahjongChoice > canvas').bind('mousedown.swap',function(e){getValue(e);});

    var valueMahjong = null;

    function getValue(e){
        var x = e.clientX - $('#idMahjongChoice > canvas').offset().left;
        var y = e.clientY - $('#idMahjongChoice > canvas').offset().top + $('body').scrollTop();

        var axeX = Math.floor(x/50);
        var axeY = Math.floor(y/55);

        if(x>=axeX*50 && x<=axeX*50+25 && y>=axeY*55 && y<=axeY*55+40){
            var value = 2 + 5 * axeY + axeX;
            valueMahjong = value;
            drawCards(value);
        }

    }

    function defineMahjong(){
        console.log(valueMahjong);
    }

    drawCards();

</script>

</body>

</html>